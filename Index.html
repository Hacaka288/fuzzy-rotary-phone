<html>
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1; user-scalable=0;"/>
  <style>
    html, body {
      margin: 0;
      background-color: floralwhite;
      height: 100%;
      width: 100%;
    }
    .title {
      text-align: center;
    }
    .center {
      margin: auto;
      align-content: center;
      text-align: center;
    }
    .button1 {
      padding: 10px 20px;
      background-color: palegoldenrod;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    .button {
      padding: 20px 27px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      border-radius: 0px;
      cursor: pointer;
    }
  </style>
  <br>
  <div class="title">
    <h2>Predict Hidden Pattern</h2>
  </div>
  <div id="centerDiv" class="center">
    <input id="restart" class='button1' type="button" value="                    Restart                    " onclick="restart()">
    <h3 id="score">Score: ?</h3>
    <p id="trial">Actions: 0 | Reveals: 0</p>
    <div id="gridDiv" class="center">
      <script type="text/javascript">
        var N = 16;
        var actions = 0;
        var reveals = 0;
        var patT = [];
        var patG = [];
        var score = 0;
        var btns = [];

        // Initialize the grid
        var gridDiv = document.getElementById('gridDiv');
        for (let i = 0; i < N; i++) {
          patT.push(0);
          patG.push(0);
          btns.push(document.createElement("button"));
          btns[i].className = 'button';
          btns[i].innerHTML = 'F';
          btns[i].style.background = '#FF0000';
          btns[i].onclick = function () {
            if (actions < 15) { // Only allow changes if game is active
              let val = btns[i].innerHTML;
              if (val == 'F') {
                val = 'T';
                patG[i] = 1;
                btns[i].style.background = '#00FF00';
              } else {
                val = 'F';
                patG[i] = 0;
                btns[i].style.background = '#FF0000';
              }
              btns[i].innerHTML = val;
            }
          };
          if (i % 4 == 0) {
            gridDiv.appendChild(document.createElement('br'));
          }
          gridDiv.appendChild(btns[i]);
        }

        // Colorize buttons based on pattern and tone
        function colorizeButtons(pat, tone) {
          var Fcolor = tone ? '#fe7474' : '#FF0000';
          var Tcolor = tone ? '#b1fe74' : '#00FF00';
          for (let i = 0; i < N; i++) {
            btns[i].innerHTML = pat[i] ? 'T' : 'F';
            btns[i].style.background = pat[i] ? Tcolor : Fcolor;
          }
        }

        // Reveal answer and restart (rematch)
        function revealAnswer() {
          reveals += 1;
          colorizeButtons(patT, true);
          setTimeout(function() {
            endGame();
            setTimeout(restart, 500); // Slight delay before restart for visibility
          }, 1000);
        }

        // Show current score
        function showScore() {
          if (actions < 15) {
            checkScore();
            document.getElementById('score').innerHTML = 'Score: ' + score;
            document.getElementById('score').style.color = 'red';
            setTimeout(hideScore, 1000);
          }
        }

        // Hide score and update actions
        function hideScore() {
          actions += 1;
          document.getElementById('score').innerHTML = 'Score: ?';
          document.getElementById('score').style.color = 'black';
          endAction();
        }

        // Check if game should end
        function endAction() {
          document.getElementById('trial').innerHTML = 'Actions: ' + actions + ' | Reveals: ' + reveals;
          if (actions >= 15) {
            endGame();
          }
        }

        // End the game and show payout
        function endGame() {
          checkScore();
          var P = 0.995 / 14; // Payout rate for 0.5% house edge, assuming E[score] â‰ˆ 14
          var payout = P * score;
          document.getElementById('score').innerHTML = 'Game over. Final score: ' + score + '. Payout: ' + payout.toFixed(3);
          for (let i = 0; i < N; i++) {
            btns[i].disabled = true;
          }
          document.getElementById('btnScore').disabled = true;
          document.getElementById('btnAnswer').disabled = true;
        }

        // Generate random hidden pattern
        function mutate() {
          for (let i = 0; i < N; i++) {
            patT[i] = Math.random() > 0.5 ? 1 : 0;
          }
        }

        // Calculate current score
        function checkScore() {
          score = 0;
          for (let i = 0; i < N; i++) {
            if (patG[i] == patT[i]) {
              score += 1;
            }
          }
        }

        // Restart the game
        function restart() {
          actions = 0;
          reveals = 0;
          patT = [];
          patG = [];
          for (let i = 0; i < N; i++) {
            patT[i] = 0;
            patG[i] = 0;
            btns[i].innerHTML = 'F';
            btns[i].style.background = '#FF0000';
            btns[i].disabled = false;
          }
          document.getElementById('trial').innerHTML = 'Actions: ' + actions + ' | Reveals: ' + reveals;
          document.getElementById('score').innerHTML = 'Score: ?';
          document.getElementById('btnScore').disabled = false;
          document.getElementById('btnAnswer').disabled = false;
          mutate();
        }

        // Start the game
        restart();
        mutate();
      </script>
    </div>
    <br><br>
    <input id="btnScore" class='button1' type="button" value="Check Score" onclick="showScore()">
    <input id="btnAnswer" class='button1' type="button" value="Reveal" onclick="revealAnswer()">
  </div>
  <br><br>
  <div class="center">
    E5 Test Modified 
  </div>
</html>
