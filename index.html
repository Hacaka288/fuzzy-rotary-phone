<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
  <style>
    body {
      display: flex;
      height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
    }

    /* Sidebar for Coins and Stake */
    .sidebar {
      position: fixed;
      left: 0;
      top: 0;
      width: 100px;
      height: 100%;
      background-color: #f0f0f0;
      padding: 15px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .coin-display {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 20px;
    }
    .stake-input {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stake-input label {
      font-size: 14px;
      margin-bottom: 5px;
    }
    .stake-input input {
      width: 60px;
      padding: 5px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    /* Main Game Area */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-left: 100px; /* Offset for sidebar */
      padding: 10px;
    }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      width: 90vw;
      max-width: 320px;
      margin-bottom: 20px;
    }
    .grid-button {
      padding: 20px;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #ff9999;
      transition: background-color 0.2s;
    }
    .grid-button.t {
      background-color: #99ff99;
    }

    /* Action Buttons */
    .footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .action-button {
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #ffd700;
      width: 200px;
      max-width: 90%;
    }
    .action-button:disabled {
      background-color: #d3d3d3;
      cursor: not-allowed;
    }

    /* Modal Styling */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 1000;
    }
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      padding: 25px;
      border-radius: 10px;
      width: 85%;
      max-width: 450px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      cursor: pointer;
      color: #555;
    }
    .modal-content h3 {
      margin-top: 0;
      color: #333;
    }
    .modal-content ul {
      padding-left: 20px;
    }
    .modal-content li {
      margin: 10px 0;
      font-size: 16px;
    }

    /* Responsive Adjustments */
    @media (max-width: 500px) {
      .sidebar {
        width: 80px;
      }
      .main {
        margin-left: 80px;
      }
      .button-grid {
        max-width: 280px;
      }
      .action-button {
        width: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="coin-display">Coins: <span id="coins">100</span></div>
    <div class="stake-input">
      <label for="stake">Challenge:</label>
      <input type="number" id="stake" value="10" min="1" step="1">
    </div>
  </div>
  <div class="main">
    <div id="gridDiv" class="button-grid"></div>
    <div class="footer">
      <button id="btnScore" class="action-button">Check Score</button>
      <button id="btnAnswer" class="action-button">Reveal Pattern</button>
      <button id="btnDouble" class="action-button" disabled>Double Stake</button>
      <button id="btnRestart" class="action-button">Restart</button>
      <button id="btnHowTo" class="action-button">How to Play</button>
    </div>
  </div>
  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="hideModal()">Ã—</span>
      <h3>How to Play</h3>
      <p>Match the hidden pattern of 'T's and 'F's in the 4x4 grid!</p>
      <ul>
        <li>Tap a button to switch between 'T' and 'F'.</li>
        <li>"Check Score" shows how many match (15 tries max).</li>
        <li>Get a perfect score (16) to win double your Challenge Coins.</li>
        <li>Lose your Challenge Coins if you fail in 15 tries.</li>
        <li>Use "Double Stake" after a loss to raise your next challenge.</li>
      </ul>
    </div>
  </div>

  <script>
    const N = 16;
    let actions = 0;
    let reveals = 0;
    let patT = Array(N).fill(0); // Hidden pattern
    let patG = Array(N).fill(0); // User guess
    let score = 0;
    let coins = Math.floor(Math.random() * 101) + 50; // Start with 50-150 coins
    const btns = [];
    const stakeInput = document.getElementById('stake');

    // Initialize grid
    const gridDiv = document.getElementById('gridDiv');
    for (let i = 0; i < N; i++) {
      const btn = document.createElement('button');
      btn.className = 'grid-button';
      btn.innerHTML = 'F';
      btn.onclick = () => toggleButton(i);
      btns.push(btn);
      gridDiv.appendChild(btn);
    }

    // Toggle button state
    function toggleButton(i) {
      if (actions < 15) {
        patG[i] = 1 - patG[i];
        btns[i].innerHTML = patG[i] ? 'T' : 'F';
        btns[i].className = 'grid-button' + (patG[i] ? ' t' : '');
      }
    }

    // Generate a random pattern
    function generatePattern() {
      do {
        for (let i = 0; i < N; i++) {
          patT[i] = Math.random() > 0.5 ? 1 : 0;
        }
      } while (patT.every(val => val === 0) || patT.every((val, idx) => val === patG[idx]));
    }

    // Calculate current score
    function checkScore() {
      score = patG.reduce((acc, val, i) => acc + (val === patT[i] ? 1 : 0), 0);
    }

    // Display score
    function showScore() {
      if (actions < 15) {
        checkScore();
        alert('Score: ' + score);
        actions++;
        if (actions >= 15) endGame();
      }
    }

    // Reveal the answer
    function revealAnswer() {
      reveals++;
      for (let i = 0; i < N; i++) {
        btns[i].innerHTML = patT[i] ? 'T' : 'F';
        btns[i].className = 'grid-button' + (patT[i] ? ' t' : '');
      }
      setTimeout(endGame, 1000);
    }

    // Double the stake
    function doubleStake() {
      let currentStake = parseInt(stakeInput.value);
      let newStake = Math.min(currentStake * 2, coins);
      stakeInput.value = newStake;
    }

    // End the game and update coins
    function endGame() {
      checkScore();
      let stake = parseInt(stakeInput.value);
      if (score === N) {
        coins += stake * 2;
      } else {
        coins -= stake;
      }
      document.getElementById('coins').innerHTML = coins;
      btns.forEach(btn => btn.disabled = true);
      document.getElementById('btnScore').disabled = true;
      document.getElementById('btnAnswer').disabled = true;
      document.getElementById('btnDouble').disabled = false;
    }

    // Restart the game
    function restart() {
      actions = 0;
      reveals = 0;
      patG.fill(0);
      generatePattern();
      for (let i = 0; i < N; i++) {
        btns[i].innerHTML = 'F';
        btns[i].className = 'grid-button';
        btns[i].disabled = false;
      }
      document.getElementById('btnScore').disabled = false;
      document.getElementById('btnAnswer').disabled = false;
      document.getElementById('btnDouble').disabled = true;
      let stake = parseInt(stakeInput.value);
      if (stake > coins) stakeInput.value = coins || 1;
    }

    // Modal functions
    function showModal() { document.getElementById('modal').style.display = 'block'; }
    function hideModal() { document.getElementById('modal').style.display = 'none'; }

    // Stake input validation
    stakeInput.addEventListener('input', function() {
      let value = parseInt(this.value);
      if (value > coins) this.value = coins;
      if (value < 1) this.value = 1;
    });

    // Event listeners for buttons
    document.getElementById('btnScore').onclick = showScore;
    document.getElementById('btnAnswer').onclick = revealAnswer;
    document.getElementById('btnDouble').onclick = doubleStake;
    document.getElementById('btnRestart').onclick = restart;
    document.getElementById('btnHowTo').onclick = showModal;

    // Initialize game
    document.getElementById('coins').innerHTML = coins;
    restart();
  </script>
</body>
</html>